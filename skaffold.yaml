---
apiVersion: skaffold/v4beta2
kind: Config
manifests:
  kustomize:
    paths:
      - infra/manifests/overlays/dev
    buildArgs:
      - --enable-helm
deploy:
  kubectl:
    flags:
      # => CustomResourceDefinition.apiextensions.k8s.io "policies.kyverno.io" is invalid:
      #    metadata.annotations: Too long: must have at most 262144 bytes
      apply: ["--server-side"]

build:
  artifacts:
    - image: ghcr.io/carhartl/golang-k8s-playground/app
      context: app
    - image: ghcr.io/carhartl/golang-k8s-playground/database-init
      context: data
portForward:
  - resourceType: deployment
    resourceName: people
    namespace: playground
    port: 8888
